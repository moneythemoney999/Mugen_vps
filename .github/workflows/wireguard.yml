name: VPS WireGuard

on:
  workflow_dispatch:

jobs:
  construire:
    runs-on: ubuntu-latest
    steps:
      - name: Installer WireGuard et générer les clés
        run: |
          sudo apt update
          sudo apt install -y wireguard qrencode curl

          umask 077
          wg genkey | tee cle_privee_serveur | wg pubkey > cle_publique_serveur
          wg genkey | tee cle_privee_client | wg pubkey > cle_publique_client

          echo "=== 🔐 Clé privée serveur ==="
          cat cle_privee_serveur
          echo "=== 🔐 Clé publique serveur ==="
          cat cle_publique_serveur
          echo "=== 🔐 Clé privée client ==="
          cat cle_privee_client
          echo "=== 🔐 Clé publique client ==="
          cat cle_publique_client

          echo "=== 🌐 IP publique du VPS ==="
          curl ifconfig.me

          echo "=== ✅ TERMINE ==="
