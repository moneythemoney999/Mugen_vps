name: WireGuard VPS

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Installer WireGuard et générer les clés
      run: |
        sudo apt update
        sudo apt install -y wireguard qrencode

        umask 077
        wg genkey | tee server_private.key | wg pubkey > server_public.key
        wg genkey | tee client_private.key | wg pubkey > client_public.key

        # Ne plus afficher les clés (juste IP publique si tu veux)
        curl ifconfig.me > ip_publique.txt
        echo "✅ Terminé. IP enregistrée dans ip_publique.txt"

    - name: Télécharger les fichiers de configuration
      uses: actions/upload-artifact@v4
      with:
        name: fichiers-vpn
        path: |
          server_private.key
          server_public.key
          client_private.key
          client_public.key
          ip_publique.txt
