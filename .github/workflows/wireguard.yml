name: VPS WireGuard Facile

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Installer WireGuard + GÃ©nÃ©rer tout
        run: |
          sudo apt update
          sudo apt install -y wireguard qrencode curl

          umask 077
          wg genkey | tee cle_privee_serveur | wg pubkey > cle_publique_serveur
          wg genkey | tee cle_privee_client | wg pubkey > cle_publique_client

          IP_PUB=$(curl -s ifconfig.me)
          echo "Adresse IP publique du VPS : $IP_PUB"

          echo "[Interface]
PrivateKey = $(cat cle_privee_client)
Address = 10.0.0.2/24
DNS = 1.1.1.1

[Peer]
PublicKey = $(cat cle_publique_serveur)
Endpoint = $IP_PUB:51820
AllowedIPs = 0.0.0.0/0" > client.conf

          echo "=== ðŸŽ‰ Fichier client.conf prÃªt ==="
          cat client.conf

          sleep 300  # pour que tu aies le temps de copier depuis les logs
